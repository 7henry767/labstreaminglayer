=======
General
=======

This manual describes the process of building liblsl from source for Windows, Mac OS X, and Linux. Since liblsl is cross-platform (it is written in standard C++ and uses some boost libraries), this process should be pretty straightforward. The following paragraphs provide a step-by-step instruction of the build process on all three platforms. 

To get an overview of the project structure, the following tree lists the directory hierarchy of the source after you've unpacked the compressed source archive:

  labstreaminglayer
  ├── Apps
  │   ├── AMTI ForcePlate
  │   ├── Examples
  │   ├── [several other apps]
  │   └── Wiimote
  └── LSL
      ├── liblsl
      │   ├── bin
      │   ├── examples
      │   ├── external
      │   │   ├── lslboost
      │   │   └── src
      │   ├── include
      │   ├── project
      │   ├── src
      │   │   ├── portable_archive
      │   │   └── pugixml
      │   └── testing
      ├── liblsl-Matlab
      ├── liblsl-Python
      └── liblsl-Java

LSL and some Apps are built with CMake, the remaining Apps use Visual Studio Solution files.

=====
CMake
=====

Tested platforms:
* Windows 7, Visual Studio 2015
* Ubuntu Linux 14.04
* (To do: Mac OS X)

Prerequisites (LSL with bundled Boost)
- CMake 3.5
- Python 2.7
- (7zip)
- Windows:
    - C++ compiler (tested: VS2015)
    - Ninja (https://ninja-build.org/)
- Linux
    - C++ compiler (tested: clang 3.5, GCC 6.2)
- OS X
    - C++ compiler (tested: XCode 8.3?)

Optional / required for some apps:
- Boost (+path set with -DBOOST_ROOT=path/to/boost)
- Qt (+path set)

To build LSL, call either `lslbuild.py` from a valid build environment (e.g. the Visual C++ command line) or do it manually:

- extract the zip file or clone the repository (`git clone https://github.com/sccn/labstreaminglayer.git`)
- change to this directory (git: `cd labstreaminglayer`)
- create a build directory (`mkdir build`) and enter it (`cd build`)
- create the generator files and define the build variables (`cmake -DVARX=Y -G "Generator Name" ../`). Notable switches are:
	 - `-DLSL_USE_SYSTEM_BOOST` to compile against the bundled (`=Off`) or system (`=On`) Boost installation
    - `-DBOOST_ROOT=/path/to/boost` to set the Boost path
    - `-DLSLAPPS_Examples=On` to also build the "Examples"-App (for a complete list see `Apps/CMakeLists.txt`
    - `-DCMAKE_BUILD_TYPE=Release` (`Release` or `Debug`) to compile with debug information or optimizations
    - `-DCMAKE_INSTALL_PREFIX` to set where to install the LSL distribution
    - `-G` to set the generator type (call without a parameter to see a list).
- start the build process (depending on the generator), e.g. `make`, `ninja` or load the generated VS Solution file
- install, e.g. `make install`, `ninja install`, in VS build the `INSTALL`-target

This will create a distribution tree similar to this:

    ├── AppX
    │   ├── AppX.exe
    │   ├── AppX.bat
    │   └── AppX_configuration.ini
    ├── AppY
    │   ├── AppY.exe
    │   ├── AppY.bat
    │   ├── AppY_conf.exe
    │   └── example.png
    ├── examples
    │   ├── CppReceive.exe
    │   ├── CppReceive.bat
    │   ├── CppSendRand.exe
    │   ├── CppSendRand.bat
    │   ├── SendDataC.exe
    │   └── SendDataC.bat
    └── LSL
        ├── cmake
        │   ├── LSLAppBoilerplate.cmake
        │   ├── LSLConfig.cmake
        │   └── [snip]
        ├── include
        │   ├── lsl_c.h
        │   └── lsl_cpp.h
        └── lib
            ├── liblsl64_MSVC14.dll
            ├── liblsl64_MSVC14.lib
            ├── lslboost.lib
            ├── Qt5Xml.dll
            ├── Qt5Gui.dll
            ├── [more Qt]
            ├── libboost-system-msvc14-mt.dll
            └── [more boost]

On Unix systems (Linux+OS X) the executable's library path is changed to include ../LSL/lib/ and ./lib/ so common libraries (Qt, Boost) can be distributed in a single library directory wheras specific libraries can be put in a subdirectory of the App dir. On Windows, a .bat-file is autogenerated that adds these library paths to the PATH variable and starts the program.

If you want to build against the compiled liblsl, please see `OutOfTreeTest/CMakeLists.txt` for an example.


